# Photo News Forwarder - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

## –ß—Ç–æ —ç—Ç–æ?

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–æ—Ç–æ –≤ —á–∞—Ç "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏".

**–õ–æ–≥–∏–∫–∞:** –ù–∞–±—Ä–∞–ª–æ 5+ –ª–∞–π–∫–æ–≤ ‚Üí –ü–µ—Ä–µ—Å–ª–∞–ª–∏ ‚Üí –ó–∞–±—ã–ª–∏

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- ‚ú® **photo_news_handler.py** - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å —Å –ª–æ–≥–∏–∫–æ–π –ø–µ—Ä–µ—Å—ã–ª–∫–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- üìù **database.py** - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ—Å—ã–ª–∫–æ–π
- üìù **config.py** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Photo News
- üìù **photo_handler.py** - –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ has_photo=1
- üìù **commands.py** - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∞–∫—Ü–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ + —É–¥–∞–ª–µ–Ω–∏–µ)
- üìù **bot.py** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è photo_news_handler

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### 1. –ó–∞–≥—Ä—É–∑–∏ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```bash
# –ù–∞ —Ç–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
cd ~/Downloads

scp database.py config.py photo_handler.py commands.py bot.py photo_news_handler.py root@89.23.117.38:/opt/adiletbot/
```

### 2. –ù–∞—Å—Ç—Ä–æ–π config.py:

```bash
ssh root@89.23.117.38
cd /opt/adiletbot
nano config.py
```

–ù–∞–π–¥–∏ —Å–µ–∫—Ü–∏—é **–ù–ê–°–¢–†–û–ô–ö–ò –ü–ï–†–ï–°–´–õ–ö–ò –ü–û–ü–£–õ–Ø–†–ù–´–• –§–û–¢–û** –∏ –Ω–∞—Å—Ç—Ä–æ–π:

```python
# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
PHOTO_NEWS_ENABLED = True

# ID —á–∞—Ç–∞ "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏" 
PHOTO_NEWS_TARGET_CHAT_ID = -1001234567890  # ‚Üê –£–ö–ê–ñ–ò –ü–†–ê–í–ò–õ–¨–ù–´–ô ID

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–∫—Ü–∏–π
PHOTO_NEWS_MIN_REACTIONS = 5

# –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–ø—É—Å—Ç–æ–π = –≤—Å–µ —á–∞—Ç—ã)
PHOTO_NEWS_SOURCE_CHATS = []
```

**–ö–∞–∫ —É–∑–Ω–∞—Ç—å ID —á–∞—Ç–∞:**
1. –î–æ–±–∞–≤—å –±–æ—Ç–∞ –≤ —á–∞—Ç "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏"
2. –û—Ç–ø—Ä–∞–≤—å –≤ —á–∞—Ç –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏: `journalctl -u adiletbot -n 50`
4. –ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É —Å chat_id (–æ–±—ã—á–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100)

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞:

```bash
systemctl restart adiletbot
systemctl status adiletbot
```

### 4. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:

```bash
journalctl -u adiletbot -n 50
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
INFO:__main__:Restored X active chats
INFO:__main__:Photo News Forwarder enabled
INFO:__main__:Bot started
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –°–æ–±—ã—Ç–∏–π–Ω–∞—è –º–æ–¥–µ–ª—å (—Ä–µ–∞–∫—Ç–∏–≤–Ω–∞—è):

1. **–ö—Ç–æ-—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –≤ —á–∞—Ç**
   - –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `has_photo=1`
   - –°—á–µ—Ç—á–∏–∫ —Ä–µ–∞–∫—Ü–∏–π = 0

2. **–ö—Ç–æ-—Ç–æ —Å—Ç–∞–≤–∏—Ç —Ä–µ–∞–∫—Ü–∏—é (–ª–∞–π–∫)**
   - –ë–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Ä–µ–∞–∫—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `—Ä–µ–∞–∫—Ü–∏–π >= 5` –ò `—Ñ–æ—Ç–æ` –ò `–µ—â–µ –Ω–µ –ø–µ—Ä–µ—Å–ª–∞–Ω–æ`?
   - –ï—Å–ª–∏ –î–ê ‚Üí **–°–†–ê–ó–£ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç** –≤ "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏"
   - –û—Ç–º–µ—á–∞–µ—Ç `is_forwarded=1`

3. **–í—Å—ë, –∑–∞–±—ã–ª–∏ –ø—Ä–æ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ**
   - –î–∞–∂–µ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –µ—â–µ –ø–æ—Å—Ç–∞–≤–∏—Ç –ª–∞–π–∫–∏ - –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –Ω–µ –±—É–¥–µ—Ç
   - –ü—Ä–∏–Ω—Ü–∏–ø: "–æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ—Å–ª–∞–ª–∏ –∏ —Ö–≤–∞—Ç–∏—Ç"

### –ù–∏–∫–∞–∫–∏—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á!
- –ù–µ –æ–ø—Ä–∞—à–∏–≤–∞–µ–º —á–∞—Ç—ã –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- –¢–æ–ª—å–∫–æ —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### PHOTO_NEWS_ENABLED
- `True` - —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- `False` - —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞

### PHOTO_NEWS_TARGET_CHAT_ID
ID —á–∞—Ç–∞ –∫—É–¥–∞ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–æ—Ç–æ.

**–ü—Ä–∏–º–µ—Ä:** `-1001234567890`

### PHOTO_NEWS_MIN_REACTIONS
–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–∫—Ü–∏–π –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏.

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `5`

**–ü—Ä–∏–º–µ—Ä—ã:**
- `3` - –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –ø—Ä–∏ 3+ –ª–∞–π–∫–∞—Ö
- `10` - –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –ø—Ä–∏ 10+ –ª–∞–π–∫–∞—Ö

### PHOTO_NEWS_SOURCE_CHATS
–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

**–ü—É—Å—Ç–æ = –±–µ—Ä—ë–º –∏–∑ –≤—Å–µ—Ö —á–∞—Ç–æ–≤:**
```python
PHOTO_NEWS_SOURCE_CHATS = []
```

**–¢–æ–ª—å–∫–æ –∏–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤:**
```python
PHOTO_NEWS_SOURCE_CHATS = [-1001111111, -1002222222]
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –±–æ—Ç –≤ –Ω—É–∂–Ω—ã—Ö —á–∞—Ç–∞—Ö:
- –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —á–∞—Ç–µ-–∏—Å—Ç–æ—á–Ω–∏–∫–µ
- –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —á–∞—Ç–µ "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏"

### 2. –û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –≤ —á–∞—Ç-–∏—Å—Ç–æ—á–Ω–∏–∫:
```
1. –û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –≤ —á–∞—Ç
2. –ü–æ—Å—Ç–∞–≤—å 5 –ª–∞–π–∫–æ–≤ (–º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ—Å–∏—Ç—å –¥—Ä—É–∑–µ–π)
3. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ –≤ "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏"
```

### 3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
```bash
journalctl -u adiletbot -f
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
INFO:photo_news_handler:Forwarded message 12345 from -100111111 to -100222222
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `messages`:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| has_photo | BOOLEAN | 1 –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ç–æ |
| total_reactions | INTEGER | –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–∫—Ü–∏–π |
| is_forwarded | BOOLEAN | 1 –µ—Å–ª–∏ —É–∂–µ –ø–µ—Ä–µ—Å–ª–∞–Ω–æ –≤ –Ω–æ–≤–æ—Å—Ç–∏ |
| forwarded_at | DATETIME | –ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Å–ª–∞–Ω–æ |

### –¢–∞–±–ª–∏—Ü–∞ `reactions`:

–¢–µ–ø–µ—Ä—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º UNIQUE - –æ–¥–∏–Ω —é–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –¥–≤–∞–∂–¥—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Ä–µ–∞–∫—Ü–∏—é.

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–∏ - –∑–∞–ø–∏—Å—å —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ë–î.

## Troubleshooting

### –ë–æ—Ç –Ω–µ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Ñ–æ—Ç–æ:

**–ü—Ä–æ–≤–µ—Ä—å:**
1. `PHOTO_NEWS_ENABLED = True` –≤ config.py
2. `PHOTO_NEWS_TARGET_CHAT_ID` —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ë–æ—Ç –≤ –æ–±–æ–∏—Ö —á–∞—Ç–∞—Ö (–∏—Å—Ç–æ—á–Ω–∏–∫ + –Ω–æ–≤–æ—Å—Ç–∏)
4. –£ –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

**–õ–æ–≥–∏:**
```bash
journalctl -u adiletbot -n 100 | grep -i photo
```

### –û—à–∏–±–∫–∞ "Chat not found":

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `PHOTO_NEWS_TARGET_CHAT_ID`.

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å –±–æ—Ç–∞ –≤ —á–∞—Ç
2. –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –¥–ª—è chat_id

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

**–ü—Ä–æ–≤–µ—Ä—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```bash
python3 -m py_compile /opt/adiletbot/photo_news_handler.py
python3 -m py_compile /opt/adiletbot/database.py
python3 -m py_compile /opt/adiletbot/photo_handler.py
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å:

–ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.

–ï—Å–ª–∏ –Ω–µ—Ç - —É–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é –ë–î (–¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–°–¢–ê):
```bash
rm /opt/adiletbot/messages.db
systemctl restart adiletbot
```

## –õ–æ–≥–∏–∫–∞ –∫–æ–¥–∞

### photo_news_handler.py
- `handle_reaction_for_news()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏
- `forward_popular_photo()` - –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Ñ–æ—Ç–æ
- `register_photo_news_handlers()` - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç handlers

### database.py (–Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- `update_message_reactions()` - –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏
- `should_forward_message()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏
- `mark_as_forwarded()` - –æ—Ç–º–µ—á–∞–µ—Ç –∫–∞–∫ –ø–µ—Ä–µ—Å–ª–∞–Ω–æ
- `delete_reaction()` - —É–¥–∞–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –∏–∑ –ë–î

### commands.py
- –£–ª—É—á—à–µ–Ω–∞ `handle_reaction()` - —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π

### photo_handler.py
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `has_photo=1` –≤ –ë–î

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ë–æ—Ç **–ù–ï** —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —á–∞—Ç–∞ "–§–æ—Ç–æ –ù–æ–≤–æ—Å—Ç–∏"
- –ë–æ—Ç **–ù–ï** –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ—Å—ã–ª–∫—É
- –ë–æ—Ç **–ù–ï** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å—ã–ª–∫–∏
- –û–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ—Å–ª–∞–ª–∏ - –≤—Å—ë, –∑–∞–±—ã–ª–∏

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –•–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä–æ–≥ —Ä–µ–∞–∫—Ü–∏–π?

```python
PHOTO_NEWS_MIN_REACTIONS = 10  # –í–º–µ—Å—Ç–æ 5
```

### –•–æ—á–µ—à—å –±—Ä–∞—Ç—å —Ñ–æ—Ç–æ —Ç–æ–ª—å–∫–æ –∏–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤?

```python
PHOTO_NEWS_SOURCE_CHATS = [-1001111111, -1002222222]
```

### –•–æ—á–µ—à—å –æ—Ç–∫–ª—é—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é?

```python
PHOTO_NEWS_ENABLED = False
```

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `journalctl -u adiletbot -n 100`
2. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.py
3. –£–±–µ–¥–∏—Å—å —á—Ç–æ –±–æ—Ç –≤ –Ω—É–∂–Ω—ã—Ö —á–∞—Ç–∞—Ö
4. –ü—Ä–æ–≤–µ—Ä—å ID —á–∞—Ç–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

---

**–§—É–Ω–∫—Ü–∏—è –≥–æ—Ç–æ–≤–∞! –ù–∞–±—Ä–∞–ª–æ 5 –ª–∞–π–∫–æ–≤ ‚Üí –ü–µ—Ä–µ—Å–ª–∞–ª–∏ ‚Üí –ó–∞–±—ã–ª–∏!** üöÄ
